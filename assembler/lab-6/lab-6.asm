.model small
.stack 100h

.data
    old_vector dw 0       ; ??? ?????????? ??????? ??????? ??????????
    message db '?????????? ????????? ???????!', 0
    div_zero_msg db '??????: ??????? ?? ????!', 0
.code
start:
    ; ????????????? ?????????
    mov ax, @data
    mov ds, ax

    ; ?????????? ?????? ?????? ??????????
    mov ax, 35h          ; ??????? ??? ????????? ??????? ??????????
    mov dx, 21h          ; ????? ?????????? (????????, 21h)
    int 21h              ; ????? DOS
    mov [old_vector], bx ; ????????? ?????? ??????

    ; ????????????? ????? ?????? ??????????
    mov ax, 25h          ; ??????? ??? ????????? ??????? ??????????
    mov dx, offset new_interrupt_handler ; ????? ?????? ???????????
    int 21h

    ; ?????? ????????? ??? ?? (????????, ??? ?????? ?????????)
    ; ????????? ??????????? ??????????
    int 21h              ; ????? ?????? ??????????

    ; ??????????????? ?????? ?????? ??????????
    mov ax, 25h          ; ??????? ??? ?????????????? ???????
    mov dx, [old_vector] ; ????????? ?????? ??????
    int 21h

    ; ??????? ?????????
    mov ah, 09h          ; ??????? ?????? ??????
    lea dx, message      ; ????? ??????
    int 21h              ; ????? DOS

    ; ????????? ?????????
    mov ah, 4Ch
    int 21h

; ?????????? ??????????
new_interrupt_handler:
    ; ?????????? ?????????, ???? ?????
    push ax
    push bx
    push cx

    ; ??? ??? ????????? ??????????
    ; ????????, ?????? ????? ?? ?????
    mov ah, 09h          ; ??????? ?????? ??????
    lea dx, message      ; ????? ??????
    int 21h              ; ????? DOS

    ; ??????????????? ????????
    pop cx
    pop bx
    pop ax

    ; ????? ?? ??????????? ??????????
    iret

; ?????????? ??? ??????? ?? ???? (?????? 0)
div_zero_handler:
    ; ?????????? ??? ??????? ?? ????
    mov ah, 09h
    lea dx, div_zero_msg
    int 21h

    ; ????????? ????????? ????? ??????
    mov ah, 4Ch
    int 21h


end start
